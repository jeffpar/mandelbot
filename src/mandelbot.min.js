(function(){/*
 Copyright Â© 2017 [Jeff Parsons](mailto:Jeff@pcjs.org)

 This file is part of an open-source project (https://github.com/jeffpar/mandelbot) with no formal license.
 All portions not licensed from other sources may be freely reused.  Any derivative work just needs to provide
 attribution along with the above copyright.

 Portions copyright 2012 Christian Stigen Larsen and licensed under [Apache License](http://www.apache.org/licenses/LICENSE-2.0),
 Version 2.0.  Those portions are clearly identified in [mandelbot.js](https://github.com/jeffpar/mandelbot/blob/master/src/mandelbot.js)
 and must be accompanied by the same Apache License if they are redistributed.
*/
for(var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,r=["Math","trunc"],u=0;u<r.length-1;u++){var v=r[u];v in n||(n[v]={});n=n[v]}
var w=r[r.length-1],x=n[w],y=x?x:function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||!a)return a;var c=Math.floor(Math.abs(a));return 0>a?-c:c};y!=x&&null!=y&&aa(n,w,{configurable:!0,writable:!0,value:y});var z=0,A=[],B=0,ba=1E3/60|0,C,E;
function F(a,c,b,d,e,f,h,g,k,l,q){a=void 0===a?0:a;c=void 0===c?0:c;b=void 0===b?G:b;d=void 0===d?H:d;e=void 0===e?I:e;f=void 0===f?J:f;K(this,l);this.c=!!L(this,M,h||!1);this.P=L(this,N,g||F.PALETTE.GRAY);this.ga=k||F.SHAPE.RECT;this.$=[0,0,0,0];this.N=[];try{this.Z(F.CONTROL_STATUS,q);var t;a:if(this.V=l,this.H=this.G=0,l){if(this.J=document.getElementById(l))if(this.H=this.J.width,this.G=this.J.height,this.F=this.J.getContext("2d")){this.F.imageSmoothingEnabled=!1;ca(this,this.J);t=!0;break a}O(this,
"Missing view canvas");t=!1}else t=!0;var p;if(p=t)a:{var m=a||this.H,D=c||this.G;if(this.B=document.createElement("canvas"))if(this.B.width=this.a=m||da,this.B.height=this.b=D||ea,this.D=this.B.getContext("2d"))if(this.l=this.D.createImageData(this.a,this.b)){p=!0;break a}O(this,"Unable to create grid canvas");p=!1}p&&(this.X=L(this,P,this.ka=b,!1),this.Y=L(this,Q,this.la=d,!1),this.T=L(this,R,this.ha=e,!0),this.U=L(this,S,this.ia=f,!0),T(this,this.X,this.Y,this.T,this.U,!1))}catch(ma){O(this,ma.message)}}
F.prototype.Z=function(a,c){var b=this;c=c?document.getElementById(c):null;switch(a){case F.CONTROL_STATUS:this.aa=c;O(this);break;case F.CONTROL_RESET:c&&(c.onclick=function(){b.N=[];U(b);b.L==b.X&&b.M==b.Y&&b.j==b.T&&b.u==b.U?T(b,G,H,I,J):T(b,b.X,b.Y,b.T,b.U)});break;case F.CONTROL_PREVIOUS:if(this.S=c)c.onclick=function(){var a=b.N.pop();if(null!=a){K(b,b.V,a);b.c=!!L(b,M,b.c);b.P=L(b,N,b.P);var a=L(b,P,b.ka,!1),c=L(b,Q,b.la,!1),f=L(b,R,b.ha,!0),h=L(b,S,b.ia,!0);T(b,a,c,f,h);U(b)}};U(this)}};
function ca(a,c){a.O||(a.O=c,a.g=a.m=-1,a.W=0,a.h=a.w=-1,a.o=a.v=0,a.ja=!1,c.addEventListener("touchstart",function(b){V(a,W,b)}),c.addEventListener("touchmove",function(b){V(a,X,b)}),c.addEventListener("touchend",function(b){V(a,Y,b)}),c.addEventListener("mousedown",function(b){b.button||V(a,W,b)}),c.addEventListener("mousemove",function(b){0<=a.g&&V(a,X,b)}),c.addEventListener("mouseup",function(b){b.button||V(a,Y,b)}),c.addEventListener("mouseout",function(b){0<=a.g&&V(a,Y,b)}))}
function V(a,c,b){var d,e;if(c<Y){b=b||window.event;b.targetTouches&&b.targetTouches.length?(d=b.targetTouches[0].pageX,e=b.targetTouches[0].pageY):(d=b.pageX,e=b.pageY);var f=0,h=0,g=a.O;do isNaN(g.offsetLeft)||(f+=g.offsetLeft,h+=g.offsetTop);while(g=g.offsetParent);d=a.H/a.O.offsetWidth*(d-f);e=a.G/a.O.offsetHeight*(e-h);d=Math.round(a.a*d/a.H);e=Math.round(a.b*e/a.G)}a.ja||b.preventDefault();if(0<=a.h){if(a.ba){b=a.a*a.b*4;for(f=0;f<b;f+=4)a.l.data[f+3]=255;a.ba=!1}a.D.putImageData(a.l,0,0)}c==
W?(a.g=d,a.m=e,a.W=Date.now()):c==X?(c=Math.abs(a.m-e),10<=Math.abs(a.g-d)&&10<=c&&(a.h=a.g,a.w=a.m,a.o=d-a.h,a.v=e-a.w,Math.abs(a.o/a.v)!=Math.abs(a.a/a.b)&&(c=Math.abs(a.a*a.v/a.b),a.o=0>a.o?-c:c))):c==Y&&(200>Date.now()-a.W&&(a.o&&a.v?(d=a.h,b=a.w,c=a.h+a.o,e=a.w+a.v,c<d&&(d=c,c=a.h),e<b&&(b=e,e=a.w),a.g>d&&a.g<c&&a.m>b&&a.m<=e&&(a.c?(c=a.f.times(c-d).dividedBy(2),e=a.i.times(e-b).dividedBy(2),d=a.A.plus(a.f.times(d)).plus(c),b=a.s.minus(a.i.times(b)).minus(e)):(c=(c-d)*a.f/2,e=(e-b)*a.i/2,d=a.A+
d*a.f+c,b=a.s-b*a.i-e),T(a,d,b,c,e,!0))):(a.c?(d=a.A.plus(a.f.times(a.g)),b=a.s.minus(a.i.times(a.m))):(d=a.A+a.g*a.f,b=a.s-a.m*a.i),T(a,d,b,a.j,a.u,!0)),a.h=a.w=-1,a.o=a.v=0),a.g=a.m=-1,a.W=0);0<=a.h&&(a.D.lineWidth=1,a.D.strokeStyle="#00FF00",a.D.strokeRect(a.h,a.w,a.o,a.v));a.F&&a.F.drawImage(a.B,0,0,a.a,a.b,0,0,a.H,a.G)}
function T(a,c,b,d,e,f){a.c?(a.L=new BigNumber(c),a.M=new BigNumber(b),a.j=new BigNumber(d),a.u=new BigNumber(e),a.A=a.L.minus(a.j),a.f=a.j.times(2).dividedBy(a.a).round(20),a.s=a.M.plus(a.u),a.i=a.u.times(2).dividedBy(a.b).round(20)):(a.L=c,a.M=b,a.j=d,a.u=e,a.A=c-d,a.f=2*d/a.a,a.s=b+e,a.i=2*e/a.b);fa(a,0);a.ba=!0;for(c=0;c<a.b;c++)for(b=0;b<a.a;b++)ga(a,b,c,16777215,0);c=a.j;b=a.u;var h;"number"==typeof c?h=Math.min(c,b):h=BigNumber.min(c,b);a.ea=Math.floor(223/Math.sqrt(.001+4*h));O(a,"X: "+a.L+
", Y: "+a.M+", D: +/-"+a.j+", Max Iterations: "+a.ea+(a.c?" (BigNumbers)":""));!1!==f&&(a.V&&(f&&(a.N.push(location.hash),U(a)),f=ha+"="+a.V,f+="&"+P+"="+a.L,f+="&"+Q+"="+a.M,f+="&"+R+"="+a.j,f+="&"+S+"="+a.u,f+="&"+M+"="+a.c,f+="&"+N+"="+a.P,location.hash=f),Z(!0))}
function fa(a,c){a.K=c;if(a.ga){var b=Math.trunc(a.b/2),d=b-a.K,b=Math.round(Math.sqrt(b*b-d*d));a.C=Math.trunc(a.a/2)-b;a.fa=2*b}else a.C=0,a.fa=a.a;a.c?(a.I=a.A.plus(a.f.times(a.C)),a.R=c?a.R.minus(a.i):a.s.plus(0)):(a.I=a.A+a.f*a.C,a.R=c?a.R-a.i:a.s)}function K(a,c,b){b=void 0===b?location.hash:b;a.ca={};if(c){for(var d={},e,f=/([^#&=]+)=([^&]*)/g;e=f.exec(b);)d[e[1]]=e[2];d[ha]==c&&(a.ca=d)}}
function L(a,c,b,d){c=a.ca[c];if("boolean"==typeof b)return c&&("true"==c||+c)||!c&&b?1:0;b=c||b;a.c&&void 0!==d?(a=new BigNumber(b),d&&(a=a.abs())):(a=+b,d&&(a=Math.abs(a)));return a}function U(a){a.S&&(a.N.length?a.S.removeAttribute("disabled"):a.S.setAttribute("disabled","disabled"))}function O(a,c){c=c||a.da||"";a.aa?(a.aa.innerHTML=c,a.da=""):a.da=c}function ga(a,c,b,d,e){c=4*(c+b*a.a);a.l.data[c]=d&255;a.l.data[c+1]=d>>8&255;a.l.data[c+2]=d>>16&255;a.l.data[c+3]=void 0===e?255:e}
function ia(a){var c=0,b=8,c=void 0===c?0:c,b=void 0===b?1:b;a=void 0===a?!1:a;var d=0,e=0;do{var f=0,h=Date.now(),g,k=50;do{k*=2;g=a?new BigNumber(G):G;var l=a?new BigNumber(H):H,l=ja(g,l,c+k);g=Date.now()-h;if(g>=ba)break;f+=c+k-l;c=0}while(1);d+=f;b&&(c=Math.floor(f/b));e++}while(0<--b);return Math.floor(d/e)}
function ja(a,c,b,d){var e=b=b||100,f=0,h=0;if("number"==typeof a){var g=0,k=0,l;do k=2*g*k+c,g=f-h+a,l=(f=g*g)+(h=k*k);while(0<--e&&4>l);if(e&&d){l=4;do k=2*g*k+c,g=f-h+a,f=g*g,h=k*k;while(0<--l)}}else{g=new BigNumber(0);k=new BigNumber(0);l=new BigNumber(0);var q=new BigNumber(0);do k=g.times(k).times(2).plus(c).round(20),g=l.minus(q).plus(a),l=g.times(g).round(20),q=k.times(k).round(20);while(0<--e&&l.plus(q).lt(4));if(e&&d){f=4;do k=g.times(k).times(2).plus(c).round(20),g=l.minus(q).plus(a),l=
g.times(g).round(20),q=k.times(k).round(20);while(0<--f);f=l.toNumber();h=q.toNumber()}}d&&(d[0]=b,d[1]=e,d[2]=f,d[3]=h);return e}function ka(a,c){1<c&&(c=1);var b=a/60,d=1*c,e=d*(1-Math.abs(b%2-1)),f=a=0,h=0;1>b?(a=d,f=e):2>b?(a=e,f=d):3>b?(f=d,h=e):4>b?(f=e,h=d):5>b?(a=e,h=d):(a=d,h=e);c-=d;return 255*(a+c)&255|(255*(f+c)&255)<<8|(255*(h+c)&255)<<16}var da=200,ea=200,G=-.65,H=0,I=1.5,J=1.5,W=1,X=2,Y=3,la=1/Math.log(2),na=Math.log(.5)*la,ha="id",P="x",Q="y",R="dx",S="dy",M="big",N="palette";
F.PALETTE={BW:1,GRAY:2,BRIGHT:3,MUTED:4,BLUE:5};F.SHAPE={RECT:0,CIRCLE:1};F.CONTROL_STATUS="status";F.CONTROL_RESET="reset";F.CONTROL_PREVIOUS="previous";C=ia();E=ia(!0);
function Z(a){if(!a){z=0;for(var c=A.length;c--;){for(var b=A[B],d=!1,e=b.C,f=b.K,h=0,g=0,k=Math.floor((b.c?E:C)/A.length);b.K<b.b;){for(;0<k&&0<b.fa--;){var d=b.ea,l=ja(b.I,b.R,d,b.$),q=b,t=b.C++,p=b.$,m=0;if(p[1]){var D=!0,m=5+(p[0]-p[1])-na-Math.log(Math.log(p[2]+p[3]))*la;switch(b.P){default:m=-1;break;case F.PALETTE.GRAY:m=Math.floor(512*m/p[0]);255<m&&(m=255);m=m|m<<8|m<<16;break;case F.PALETTE.BRIGHT:m=ka(360*m/p[0],1);break;case F.PALETTE.MUTED:D=!1;case F.PALETTE.BLUE:m=ka(360*m/p[0],10*
m/p[0]),D&&(m=m&4278255360|m>>16&255|(m&255)<<16)}}ga(q,t,b.K,m);b.c?b.I=b.I.plus(b.f):b.I+=b.f;g||h++;k-=d-l;d=!0}if(0>=k)break;fa(b,b.K+1);g++;e=0;h=b.a}d&&(0<b.C&&g++,h=void 0===h?b.a:h,g=void 0===g?b.b:g,b.D.putImageData(b.l,0,0,void 0===e?0:e,void 0===f?0:f,h,g),b.F&&b.F.drawImage(b.B,0,0,b.a,b.b,0,0,b.H,b.G));d&&(a=!0);++B>=A.length&&(B=0)}}a&&!z&&(z=setTimeout(Z,0))}window.Mandelbot=F;F.prototype.addControl=F.prototype.Z;
window.newMandelbot=function(a,c,b,d,e,f,h,g,k,l,q,t){t=void 0===t?!0:t;a=new F(a,c,b,d,e,f,h,g,k,l,q);t&&(A.push(a),Z(!0));return a};})() //# sourceMappingURL=/src/mandelbot.js.map
