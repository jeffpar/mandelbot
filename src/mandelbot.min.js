(function(){/*
 Copyright Â© 2017 [Jeff Parsons](mailto:Jeff@pcjs.org)

 This file is part of an open-source project (https://github.com/jeffpar/mandelbot) with no formal license.
 All portions not licensed from other sources may be freely reused.  Any derivative work just needs to provide
 attribution along with the above copyright.

 Portions copyright 2012 Christian Stigen Larsen and licensed under [Apache License](http://www.apache.org/licenses/LICENSE-2.0),
 Version 2.0.  Those portions are clearly identified in [mandelbot.js](https://github.com/jeffpar/mandelbot/blob/master/src/mandelbot.js)
 and must be accompanied by the same Apache License if they are redistributed.
*/
var p=0,q=[],t=0,u=1E3/60|0,v,w;
function x(a,c,b,d,e,f,h,g,k,n){a=void 0===a?0:a;c=void 0===c?0:c;b=void 0===b?y:b;d=void 0===d?z:d;e=void 0===e?A:e;f=void 0===f?B:f;C(this,k);this.b=!!D(this,E,h||!1);this.da=void 0!==g?g:x.COLOR_SCHEME.GRAY;this.Z=[0,0,0,0];this.N=[];try{this.$(x.CONTROL_STATUS,n);var l;a:if(this.U=k,this.I=this.H=0,k){if(this.M=document.getElementById(k))if(this.I=this.M.width,this.H=this.M.height,this.G=this.M.getContext("2d")){this.G.imageSmoothingEnabled=!1;F(this,this.M);l=!0;break a}G(this,"Missing view canvas");
l=!1}else l=!0;var m;if(m=l)a:{var r=a||this.I,X=c||this.H;if(this.C=document.createElement("canvas"))if(this.C.width=this.a=r||H,this.C.height=this.g=X||I,this.F=this.C.getContext("2d"))if(this.B=this.F.createImageData(this.a,this.g)){m=!0;break a}G(this,"Unable to create grid canvas");m=!1}m&&(this.W=D(this,J,this.ha=b),this.X=D(this,K,this.ia=d),this.S=D(this,L,this.ea=e,!0),this.T=D(this,M,this.fa=f,!0),N(this,this.W,this.X,this.S,this.T,!1))}catch(aa){G(this,aa.message)}}
x.prototype.$=function(a,c){var b=this;c=c?document.getElementById(c):null;switch(a){case x.CONTROL_STATUS:this.Y=c;G(this);break;case x.CONTROL_RESET:c&&(c.onclick=function(){b.N=[];O(b);b.J==b.W&&b.K==b.X&&b.f==b.S&&b.i==b.T?N(b,y,z,A,B):N(b,b.W,b.X,b.S,b.T)});break;case x.CONTROL_PREVIOUS:if(this.R=c)c.onclick=function(){var a=b.N.pop();if(null!=a){C(b,b.U,a);b.b=!!D(b,E,b.b);var a=D(b,J,b.ha),c=D(b,K,b.ia),f=D(b,L,b.ea,!0),h=D(b,M,b.fa,!0);N(b,a,c,f,h);O(b)}};O(this)}};
function F(a,c){a.O||(a.O=c,a.c=a.o=-1,a.V=0,a.h=a.v=-1,a.s=a.A=0,a.ga=!1,c.addEventListener("touchstart",function(b){P(a,Q,b)}),c.addEventListener("touchmove",function(b){P(a,R,b)}),c.addEventListener("touchend",function(b){P(a,S,b)}),c.addEventListener("mousedown",function(b){b.button||P(a,Q,b)}),c.addEventListener("mousemove",function(b){0<=a.c&&P(a,R,b)}),c.addEventListener("mouseup",function(b){b.button||P(a,S,b)}),c.addEventListener("mouseout",function(b){0<=a.c&&P(a,S,b)}))}
function P(a,c,b){var d,e;if(c<S){b=b||window.event;b.targetTouches&&b.targetTouches.length?(d=b.targetTouches[0].pageX,e=b.targetTouches[0].pageY):(d=b.pageX,e=b.pageY);var f=0,h=0,g=a.O;do isNaN(g.offsetLeft)||(f+=g.offsetLeft,h+=g.offsetTop);while(g=g.offsetParent);d=a.I/a.O.offsetWidth*(d-f);e=a.H/a.O.offsetHeight*(e-h);d=Math.round(a.a*d/a.I);e=Math.round(a.g*e/a.H)}a.ga||b.preventDefault();0<=a.h&&a.F.putImageData(a.B,0,0);c==Q?(a.c=d,a.o=e,a.V=Date.now()):c==R?(c=Math.abs(a.o-e),10<=Math.abs(a.c-
d)&&10<=c&&(a.h=a.c,a.v=a.o,a.s=d-a.h,a.A=e-a.v,Math.abs(a.s/a.A)!=Math.abs(a.a/a.g)&&(c=Math.abs(a.a*a.A/a.g),a.s=0>a.s?-c:c))):c==S&&(200>Date.now()-a.V&&(a.s&&a.A?(d=a.h,b=a.v,c=a.h+a.s,e=a.v+a.A,c<d&&(d=c,c=a.h),e<b&&(b=e,e=a.v),a.c>d&&a.c<c&&a.o>b&&a.o<=e&&(a.b?(c=a.j.times(c-d).dividedBy(2),e=a.m.times(e-b).dividedBy(2),d=a.l.plus(a.j.times(d)).plus(c),b=a.w.minus(a.m.times(b)).minus(e)):(c=(c-d)*a.j/2,e=(e-b)*a.m/2,d=a.l+d*a.j+c,b=a.w-b*a.m-e),N(a,d,b,c,e,!0))):(a.b?(d=a.l.plus(a.j.times(a.c)),
b=a.w.minus(a.m.times(a.o))):(d=a.l+a.c*a.j,b=a.w-a.o*a.m),N(a,d,b,a.f,a.i,!0)),a.h=a.v=-1,a.s=a.A=0),a.c=a.o=-1,a.V=0);0<=a.h&&(a.F.lineWidth=1,a.F.strokeStyle="#00FF00",a.F.strokeRect(a.h,a.v,a.s,a.A));a.G&&a.G.drawImage(a.C,0,0,a.a,a.g,0,0,a.I,a.H)}
function N(a,c,b,d,e,f){a.b?(a.J=new BigNumber(c),a.K=new BigNumber(b),a.f=new BigNumber(d),a.i=new BigNumber(e),a.l=a.J.minus(a.f),a.j=a.f.times(2).dividedBy(a.a).round(20),a.w=a.K.plus(a.i),a.m=a.i.times(2).dividedBy(a.g).round(20),a.u=a.l.plus(0),a.L=a.w.plus(0)):(a.J=c,a.K=b,a.f=d,a.i=e,a.l=a.J-a.f,a.j=2*a.f/a.a,a.w=a.K+a.i,a.m=2*a.i/a.g,a.u=a.l,a.L=a.w);a.D=a.P=0;c=a.f;b=a.i;var h;"number"==typeof c?h=Math.min(c,b):h=BigNumber.min(c,b);a.ca=Math.floor(223/Math.sqrt(.001+4*h));G(a,"X: "+a.J+", Y: "+
a.K+", D: +/-"+a.f+", Max Iterations: "+a.ca+(a.b?" (BigNumbers)":""));!1!==f&&(a.U&&(f&&(a.N.push(location.hash),O(a)),f=T+"="+a.U,f+="&"+J+"="+a.J,f+="&"+K+"="+a.K,f+="&"+L+"="+a.f,f+="&"+M+"="+a.i,f+="&"+E+"="+a.b,location.hash=f),U(!0))}function C(a,c,b){b=void 0===b?location.hash:b;a.aa={};if(c){for(var d={},e,f=/([^#&=]+)=([^&]*)/g;e=f.exec(b);)d[e[1]]=e[2];d[T]==c&&(a.aa=d)}}
function D(a,c,b,d){c=a.aa[c];if("boolean"==typeof b)return c&&("true"==c||+c)||!c&&b?1:0;b=c||b;a.b?(a=new BigNumber(b),d&&(a=a.abs())):(a=+b,d&&(a=Math.abs(a)));return a}function O(a){a.R&&(a.N.length?a.R.removeAttribute("disabled"):a.R.setAttribute("disabled","disabled"))}function G(a,c){c=c||a.ba||"";a.Y?(a.Y.innerHTML=c,a.ba=""):a.ba=c}
function V(a){var c=0,b=8,c=void 0===c?0:c,b=void 0===b?1:b;a=void 0===a?!1:a;var d=0,e=0;do{var f=0,h=Date.now(),g,k=50;do{k*=2;g=a?new BigNumber(y):y;var n=a?new BigNumber(z):z,n=W(g,n,c+k);g=Date.now()-h;if(g>=u)break;f+=c+k-n;c=0}while(1);d+=f;b&&(c=Math.floor(f/b));e++}while(0<--b);return Math.floor(d/e)}
function W(a,c,b,d){var e=b=b||100,f=0,h=0;if("number"==typeof a){var g=0,k=0,n;do k=2*g*k+c,g=f-h+a,n=(f=g*g)+(h=k*k);while(0<--e&&4>n);if(e&&d){n=4;do k=2*g*k+c,g=f-h+a,f=g*g,h=k*k;while(0<--n)}}else{g=new BigNumber(0);k=new BigNumber(0);n=new BigNumber(0);var l=new BigNumber(0);do k=g.times(k).times(2).plus(c).round(20),g=n.minus(l).plus(a),n=g.times(g).round(20),l=k.times(k).round(20);while(0<--e&&n.plus(l).lt(4));if(e&&d){f=4;do k=g.times(k).times(2).plus(c).round(20),g=n.minus(l).plus(a),n=
g.times(g).round(20),l=k.times(k).round(20);while(0<--f);f=n.toNumber();h=l.toNumber()}}d&&(d[0]=b,d[1]=e,d[2]=f,d[3]=h);return e}function Y(a,c){1<c&&(c=1);var b=a/60,d=1*c,e=d*(1-Math.abs(b%2-1)),f=a=0,h=0;1>b?(a=d,f=e):2>b?(a=e,f=d):3>b?(f=d,h=e):4>b?(f=e,h=d):5>b?(a=e,h=d):(a=d,h=e);c-=d;return 255*(a+c)&255|(255*(f+c)&255)<<8|(255*(h+c)&255)<<16}var H=200,I=200,y=-.75,z=0,A=1.5,B=1.5,Q=1,R=2,S=3,Z=1/Math.log(2),ba=Math.log(.5)*Z,T="id",J="x",K="y",L="dx",M="dy",E="big";
x.COLOR_SCHEME={BW:0,HSV1:1,HSV2:2,HSV3:3,GRAY:4};x.CONTROL_STATUS="status";x.CONTROL_RESET="reset";x.CONTROL_PREVIOUS="previous";v=V();w=V(!0);
function U(a){if(!a){p=0;for(var c=q.length;c--;){for(var b=q[t],d=!1,e=b.D,f=b.P,h=0,g=0,k=Math.floor((b.b?w:v)/q.length);b.P<b.g;){for(;0<k&&b.D<b.a;){var d=b.ca,n=W(b.u,b.L,d,b.Z),l=b.Z,m=0;if(l[1]){var r=!0,m=5+(l[0]-l[1])-ba-Math.log(Math.log(l[2]+l[3]))*Z;switch(b.da){default:m=-1;break;case x.COLOR_SCHEME.HSV1:m=Y(360*m/l[0],1);break;case x.COLOR_SCHEME.HSV2:r=!1;case x.COLOR_SCHEME.HSV3:m=Y(360*m/l[0],10*m/l[0]);r&&(m=m&4278255360|m>>16&255|(m&255)<<16);break;case x.COLOR_SCHEME.GRAY:m=Math.floor(512*
m/l[0]),255<m&&(m=255),m=m|m<<8|m<<16}}l=b;r=4*(b.P*l.a+b.D);l.B.data[r]=m&255;l.B.data[r+1]=m>>8&255;l.B.data[r+2]=m>>16&255;l.B.data[r+3]=255;b.b?b.u=b.u.plus(b.j):b.u+=b.j;b.D++;g||h++;k-=d-n;d=!0}if(0>=k)break;b.D=0;b.b?(b.u=b.l.plus(0),b.L=b.L.minus(b.m)):(b.u=b.l,b.L-=b.m);b.P++;g++;e=0;h=b.a}d&&(0<b.D&&g++,h=void 0===h?b.a:h,g=void 0===g?b.g:g,b.F.putImageData(b.B,0,0,void 0===e?0:e,void 0===f?0:f,h,g),b.G&&b.G.drawImage(b.C,0,0,b.a,b.g,0,0,b.I,b.H));d&&(a=!0);++t>=q.length&&(t=0)}}a&&!p&&
(p=setTimeout(U,0))}window.Mandelbot=x;x.prototype.addControl=x.prototype.$;window.newMandelbot=function(a,c,b,d,e,f,h,g,k,n,l){l=void 0===l?!0:l;a=new x(a,c,b,d,e,f,h,g,k,n);l&&(q.push(a),U(!0));return a};})() //# sourceMappingURL=/src/mandelbot.js.map
