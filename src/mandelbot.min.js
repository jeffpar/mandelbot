(function(){/*
 Copyright Â© 2017 [Jeff Parsons](mailto:Jeff@pcjs.org)

 This file is part of an open-source project (https://github.com/jeffpar/mandelbot) with no formal license.
 All portions not licensed from other sources may be freely reused.  Any derivative work just needs to provide
 attribution along with the above copyright.

 Portions copyright 2012 Christian Stigen Larsen and licensed under [Apache License](http://www.apache.org/licenses/LICENSE-2.0),
 Version 2.0.  Those portions are clearly identified in [mandelbot.js](https://github.com/jeffpar/mandelbot/blob/master/src/mandelbot.js)
 and must be accompanied by the same Apache License if they are redistributed.
*/
for(var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)},m="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,r=["Math","trunc"],u=0;u<r.length-1;u++){var v=r[u];v in m||(m[v]={});m=m[v]}
var w=r[r.length-1],x=m[w],y=x?x:function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||!a)return a;var c=Math.floor(Math.abs(a));return 0>a?-c:c};y!=x&&null!=y&&aa(m,w,{configurable:!0,writable:!0,value:y});var z=0,A=[],B=0,ba=1E3/60|0,C,E;
function F(a,c,b,d,e,f,h,g,k,l,q){a=void 0===a?0:a;c=void 0===c?0:c;b=void 0===b?G:b;d=void 0===d?H:d;I(this,l);this.f=!!J(this,K,h||!1);this.R=J(this,L,g||F.PALETTE.GRAY);this.ga=k||F.SHAPE.RECT;this.$=[0,0,0,0];this.N=[];try{this.Z(F.CONTROL_STATUS,q);var t;a:if(this.P=l,this.I=this.H=0,l){if(this.C=document.getElementById(l))if(this.I=this.C.width,this.H=this.C.height,this.G=this.C.getContext("2d")){this.G.imageSmoothingEnabled=!1;ca(this,this.C);t=!0;break a}M(this,"Missing view canvas");t=!1}else t=
!0;var p;if(p=t)a:{var n=a||this.I,D=c||this.H;if(this.B=document.createElement("canvas"))if(this.B.width=this.a=n||da,this.B.height=this.b=D||ea,this.F=this.B.getContext("2d"))if(this.l=this.F.createImageData(this.a,this.b)){p=!0;break a}M(this,"Unable to create grid canvas");p=!1}p&&(e=e||N,f=f||this.b/this.a*O,this.X=J(this,P,this.ka=b,!1),this.Y=J(this,Q,this.la=d,!1),this.U=J(this,R,this.ha=e,!0),this.V=J(this,S,this.ia=f,!0),T(this,this.X,this.Y,this.U,this.V,!1))}catch(ma){M(this,ma.message)}}
F.prototype.Z=function(a,c){var b=this;c=c?document.getElementById(c):null;switch(a){case F.CONTROL_STATUS:this.aa=c;M(this);break;case F.CONTROL_RESET:c&&(c.onclick=function(){b.N=[];U(b);b.J==b.X&&b.M==b.Y&&b.i==b.U&&b.v==b.V?T(b,G,H,N,b.b/b.a*O):T(b,b.X,b.Y,b.U,b.V)});break;case F.CONTROL_PREVIOUS:if(this.T=c)c.onclick=function(){var a=b.N.pop();if(null!=a){I(b,b.P,a);b.f=!!J(b,K,b.f);b.R=J(b,L,b.R);var a=J(b,P,b.ka,!1),c=J(b,Q,b.la,!1),f=J(b,R,b.ha,!0),h=J(b,S,b.ia,!0);T(b,a,c,f,h);U(b)}};U(this);
break;case F.CONTROL_DOWNLOAD:c&&(c.onclick=function(){var a=b.C.toDataURL("image/png"),c=document.createElement("a");c&&"string"!=typeof c.download&&(c=null);c?(c.href=a,c.download="mandelbot.png",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.alert("Check your Downloads folder for mandelbot.png.")):(window.open(a),window.alert("Check your browser for a new window/tab containing the requested data (mandelbot.png)"))})}};
function ca(a,c){a.O||(a.O=c,a.g=a.m=-1,a.W=0,a.h=a.A=-1,a.o=a.w=0,a.ja=!1,c.addEventListener("touchstart",function(b){V(a,W,b)}),c.addEventListener("touchmove",function(b){V(a,X,b)}),c.addEventListener("touchend",function(b){V(a,Y,b)}),c.addEventListener("mousedown",function(b){b.button||V(a,W,b)}),c.addEventListener("mousemove",function(b){0<=a.g&&V(a,X,b)}),c.addEventListener("mouseup",function(b){b.button||V(a,Y,b)}),c.addEventListener("mouseout",function(b){0<=a.g&&V(a,Y,b)}))}
function V(a,c,b){var d,e;if(c<Y){b=b||window.event;b.targetTouches&&b.targetTouches.length?(d=b.targetTouches[0].pageX,e=b.targetTouches[0].pageY):(d=b.pageX,e=b.pageY);var f=0,h=0,g=a.O;do isNaN(g.offsetLeft)||(f+=g.offsetLeft,h+=g.offsetTop);while(g=g.offsetParent);d=a.I/a.O.offsetWidth*(d-f);e=a.H/a.O.offsetHeight*(e-h);d=Math.round(a.a*d/a.I);e=Math.round(a.b*e/a.H)}a.ja||b.preventDefault();if(0<=a.h){if(a.ba){b=a.a*a.b*4;for(f=0;f<b;f+=4)a.l.data[f+3]=255;a.ba=!1}a.F.putImageData(a.l,0,0)}c==
W?(a.g=d,a.m=e,a.W=Date.now()):c==X?(c=Math.abs(a.m-e),10<=Math.abs(a.g-d)&&10<=c&&(a.h=a.g,a.A=a.m,a.o=d-a.h,a.w=e-a.A,Math.abs(a.o/a.w)!=Math.abs(a.a/a.b)&&(c=Math.abs(a.a*a.w/a.b),a.o=0>a.o?-c:c))):c==Y&&(200>Date.now()-a.W&&(a.o&&a.w?(d=a.h,b=a.A,c=a.h+a.o,e=a.A+a.w,c<d&&(d=c,c=a.h),e<b&&(b=e,e=a.A),a.g>d&&a.g<c&&a.m>b&&a.m<=e&&(a.f?(c=a.c.times(c-d).dividedBy(2),e=a.j.times(e-b).dividedBy(2),d=a.s.plus(a.c.times(d)).plus(c),b=a.u.minus(a.j.times(b)).minus(e)):(c=(c-d)*a.c/2,e=(e-b)*a.j/2,d=a.s+
d*a.c+c,b=a.u-b*a.j-e),T(a,d,b,c,e,!0))):(a.f?(d=a.s.plus(a.c.times(a.g)),b=a.u.minus(a.j.times(a.m))):(d=a.s+a.g*a.c,b=a.u-a.m*a.j),T(a,d,b,a.i,a.v,!0)),a.h=a.A=-1,a.o=a.w=0),a.g=a.m=-1,a.W=0);0<=a.h&&(a.F.lineWidth=1,a.F.strokeStyle="#00FF00",a.F.strokeRect(a.h,a.A,a.o,a.w));a.G&&a.G.drawImage(a.B,0,0,a.a,a.b,0,0,a.I,a.H)}
function T(a,c,b,d,e,f){a.f?(a.J=new BigNumber(c),a.M=new BigNumber(b),a.i=new BigNumber(d),a.v=new BigNumber(e),a.s=a.J.minus(a.i),a.c=a.i.times(2).dividedBy(a.a).round(20),a.u=a.M.plus(a.v),a.j=a.v.times(2).dividedBy(a.b).round(20)):(a.J=c,a.M=b,a.i=d,a.v=e,a.s=c-d,a.c=2*d/a.a,a.u=b+e,a.j=2*e/a.b,console.log("prepGrid("+a.P+"): "+a.J+"-"+a.i+" "+a.a+" ("+a.s+"+"+a.c+")"));fa(a,0);a.ba=!0;for(c=0;c<a.b;c++)for(b=0;b<a.a;b++)ga(a,b,c,16777215,0);c=a.i;b=a.v;var h;"number"==typeof c?h=Math.min(c,b):
h=BigNumber.min(c,b);a.ea=Math.floor(223/Math.sqrt(.001+4*h));M(a,"X: "+a.J+", Y: "+a.M+", D: +/-"+a.i+", Max Iterations: "+a.ea+(a.f?" (BigNumbers)":""));!1!==f&&(a.P&&(f&&(a.N.push(location.hash),U(a)),f=ha+"="+a.P,f+="&"+P+"="+a.J,f+="&"+Q+"="+a.M,f+="&"+R+"="+a.i,f+="&"+S+"="+a.v,f+="&"+K+"="+a.f,f+="&"+L+"="+a.R,location.hash=f),Z(!0))}
function fa(a,c){a.L=c;if(a.ga){var b=Math.trunc(a.b/2),d=b-a.L,b=Math.round(Math.sqrt(b*b-d*d));a.D=Math.trunc(a.a/2)-b;a.fa=2*b}else a.D=0,a.fa=a.a;a.f?(a.K=a.s.plus(a.c.times(a.D)),a.S=c?a.S.minus(a.j):a.u.plus(0)):(a.K=a.s+a.c*a.D,a.S=c?a.S-a.j:a.u)}function I(a,c,b){b=void 0===b?location.hash:b;a.ca={};if(c){for(var d={},e,f=/([^#&=]+)=([^&]*)/g;e=f.exec(b);)d[e[1]]=e[2];d[ha]==c&&(a.ca=d)}}
function J(a,c,b,d){c=a.ca[c];if("boolean"==typeof b)return c&&("true"==c||+c)||!c&&b?1:0;b=c||b;a.f&&void 0!==d?(a=new BigNumber(b),d&&(a=a.abs())):(a=+b,d&&(a=Math.abs(a)));return a}function U(a){a.T&&(a.N.length?a.T.removeAttribute("disabled"):a.T.setAttribute("disabled","disabled"))}function M(a,c){c=c||a.da||"";a.aa?(a.aa.innerHTML=c,a.da=""):a.da=c}function ga(a,c,b,d,e){c=4*(c+b*a.a);a.l.data[c]=d&255;a.l.data[c+1]=d>>8&255;a.l.data[c+2]=d>>16&255;a.l.data[c+3]=void 0===e?255:e}
function ia(a){var c=0,b=8,c=void 0===c?0:c,b=void 0===b?1:b;a=void 0===a?!1:a;var d=0,e=0;do{var f=0,h=Date.now(),g,k=50;do{k*=2;g=a?new BigNumber(G):G;var l=a?new BigNumber(H):H,l=ja(g,l,c+k);g=Date.now()-h;if(g>=ba)break;f+=c+k-l;c=0}while(1);d+=f;b&&(c=Math.floor(f/b));e++}while(0<--b);return Math.floor(d/e)}
function ja(a,c,b,d){var e=b=b||100,f=0,h=0;if("number"==typeof a){var g=0,k=0,l;do k=2*g*k+c,g=f-h+a,l=(f=g*g)+(h=k*k);while(0<--e&&4>l);if(e&&d){l=4;do k=2*g*k+c,g=f-h+a,f=g*g,h=k*k;while(0<--l)}}else{g=new BigNumber(0);k=new BigNumber(0);l=new BigNumber(0);var q=new BigNumber(0);do k=g.times(k).times(2).plus(c).round(20),g=l.minus(q).plus(a),l=g.times(g).round(20),q=k.times(k).round(20);while(0<--e&&l.plus(q).lt(4));if(e&&d){f=4;do k=g.times(k).times(2).plus(c).round(20),g=l.minus(q).plus(a),l=
g.times(g).round(20),q=k.times(k).round(20);while(0<--f);f=l.toNumber();h=q.toNumber()}}d&&(d[0]=b,d[1]=e,d[2]=f,d[3]=h);return e}function ka(a,c){1<c&&(c=1);var b=a/60,d=1*c,e=d*(1-Math.abs(b%2-1)),f=a=0,h=0;1>b?(a=d,f=e):2>b?(a=e,f=d):3>b?(f=d,h=e):4>b?(f=e,h=d):5>b?(a=e,h=d):(a=d,h=e);c-=d;return 255*(a+c)&255|(255*(f+c)&255)<<8|(255*(h+c)&255)<<16}var da=200,ea=200,G=-.65,H=0,N=1.5,O=1.5,W=1,X=2,Y=3,la=1/Math.log(2),na=Math.log(.5)*la,ha="id",P="x",Q="y",R="dx",S="dy",K="big",L="palette";
F.PALETTE={BW:1,GRAY:2,BRIGHT:3,MUTED:4,BLUE:5};F.SHAPE={RECT:0,CIRCLE:1};F.CONTROL_DOWNLOAD="download";F.CONTROL_STATUS="status";F.CONTROL_RESET="reset";F.CONTROL_PREVIOUS="previous";C=ia();E=ia(!0);
function Z(a){if(!a){z=0;for(var c=A.length;c--;){for(var b=A[B],d=!1,e=b.D,f=b.L,h=0,g=0,k=Math.floor((b.f?E:C)/A.length);b.L<b.b;){for(;0<k&&0<b.fa--;){var d=b.ea,l=ja(b.K,b.S,d,b.$),q=b,t=b.D++,p=b.$,n=0;if(p[1]){var D=!0,n=5+(p[0]-p[1])-na-Math.log(Math.log(p[2]+p[3]))*la;switch(b.R){default:n=-1;break;case F.PALETTE.GRAY:n=Math.floor(512*n/p[0]);255<n&&(n=255);n=n|n<<8|n<<16;break;case F.PALETTE.BRIGHT:n=ka(360*n/p[0],1);break;case F.PALETTE.MUTED:D=!1;case F.PALETTE.BLUE:n=ka(360*n/p[0],10*
n/p[0]),D&&(n=n&4278255360|n>>16&255|(n&255)<<16)}}ga(q,t,b.L,n);b.f?b.K=b.K.plus(b.c):b.K+=b.c;g||h++;k-=d-l;d=!0}if(0>=k)break;fa(b,b.L+1);g++;e=0;h=b.a}d&&(0<b.D&&g++,h=void 0===h?b.a:h,g=void 0===g?b.b:g,b.F.putImageData(b.l,0,0,void 0===e?0:e,void 0===f?0:f,h,g),b.G&&b.G.drawImage(b.B,0,0,b.a,b.b,0,0,b.I,b.H));d&&(a=!0);++B>=A.length&&(B=0)}}a&&!z&&(z=setTimeout(Z,0))}window.Mandelbot=F;F.prototype.addControl=F.prototype.Z;
window.newMandelbot=function(a,c,b,d,e,f,h,g,k,l,q,t){t=void 0===t?!0:t;a=new F(a,c,b,d,e,f,h,g,k,l,q);t&&(A.push(a),Z(!0));return a};})() //# sourceMappingURL=/src/mandelbot.js.map
